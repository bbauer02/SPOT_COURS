:_chapter:
:_author: Bauer Baptiste
:_duration: 4 heures
:_version_number: 1.0.0
:_version_date: 02/09/2025
[[aws-ssh]]
= IntÃ©gration continue avec JENKINS
include::../../../run_app.adoc[]

== Introduction

Imaginez un monde oÃ¹ chaque modification de code est automatiquement testÃ©e, compilÃ©e et dÃ©ployÃ©e sans que vous ayez besoin dâ€™intervenir manuellement.
Câ€™est exactement ce que permet Jenkins.
Jenkins est un outil open-source dâ€™intÃ©gration continue et de livraison continue (CI/CD), utilisÃ© par des millions de dÃ©veloppeurs et dâ€™Ã©quipes DevOps Ã  travers le monde.

Sa force ? Automatiser vos tÃ¢ches rÃ©pÃ©titives de build, de test et de dÃ©ploiement, afin dâ€™accÃ©lÃ©rer vos livraisons et de sÃ©curiser vos projets logiciels.
Dans cette vidÃ©o, nous allons dÃ©couvrir ce quâ€™est Jenkins, Ã  quoi il sert, et pourquoi il est devenu un incontournable dans lâ€™univers du DevOps et du dÃ©veloppement moderne.

Jenkins est un logiciel open-source qui permet dâ€™automatiser les Ã©tapes du cycle de vie dâ€™une application : compiler le code, lancer les tests, dÃ©tecter les erreurs et mÃªme dÃ©ployer automatiquement sur un serveur.

Pourquoi est-ce important ?

Parce quâ€™au lieu de refaire manuellement les mÃªmes tÃ¢ches Ã  chaque modification, Jenkins sâ€™occupe de tout. Câ€™est un peu comme un chef dâ€™orchestre qui coordonne tous les outils du dÃ©veloppeur et de lâ€™administrateur systÃ¨me.

Dans ce cours, on va voir ensemble :ce quâ€™est Jenkins et son rÃ´le dans lâ€™intÃ©gration continue (CI) et la livraison continue (CD), comment il sâ€™installe et sâ€™utilise, et quelques exemples concrets pour vos projets."


== Objectifs

A chaque modification de code d'une application dans le gestionnaire de configuration, Jenkins se charge
automatiquement de la recompiler et de la tester.

Cette sÃ©quence a pour objectif de mettre en place un processus dâ€™intÃ©gration continue lors du dÃ©veloppement dâ€™une application grÃ¢ce Ã  Jenkins. Elle se compose de plusieurs parties permettant :

â€¢ dâ€™installer et de configurer Jenkins ;
â€¢ de crÃ©er des builds et les lancer de maniÃ¨re automatisÃ©e ;
â€¢ de crÃ©er et de configurer des pipelines dans Jenkins ;
â€¢ dâ€™Ã©crire un JenkinsFile ;
â€¢ de crÃ©er des dÃ©clencheurs pour automatiser le lancement de jobs aprÃ¨s une mise Ã  jour dâ€™une application ;
â€¢ de crÃ©er des scripts Jenkins pour rÃ©pondre Ã  des besoins spÃ©cifiques.


== ActivitÃ© 1 : Installation et configuration de Jenkins

=== Ã‰tape 1 : TÃ©lÃ©chargement et exÃ©cution de l'image Docker Jenkins
==== TÃ©lÃ©charger l'image Docker Jenkins

Dans cette Ã©tape, vous allez tÃ©lÃ©charger l'image Docker Jenkins. Vous allez ensuite dÃ©marrer une instance de
l'image et vÃ©rifier que le serveur Jenkins est en cours d'exÃ©cution.

DÃ©terminons dans un premier temps quelle sera l'imagine Docker que nous allons utiliser pour installer Jenkins.
Nous allons utiliser l'image officielle de Jenkins disponible sur Docker Hub.
Cette image est maintenue par la communautÃ© Jenkins et est rÃ©guliÃ¨rement mise Ã  jour avec les derniÃ¨res versions de Jenkins et des plugins.

image::images/01.png[]

https://hub.docker.com/r/jenkins/jenkins

[source,bash]
.A ce jour le tag de version LTS la plus rÃ©cente est la `lts-jdk21` :
----
docker pull jenkins/jenkins:lts-jdk21
----

[NOTE]
====
*Version LTS ou JDK ?*

** *Jenkins LTS*
*** LTS = Long-Term Support (support Ã  long terme).
*** Câ€™est la *version stable* de Jenkins, mise Ã  jour tous les 12 semaines environ.
*** Elle est recommandÃ©e pour la *production* (entreprise, serveurs dâ€™intÃ©gration continue).
*** Objectif : fiabilitÃ©, sÃ©curitÃ©, stabilitÃ©.

ğŸ‘‰ Ã€ lâ€™inverse, il existe aussi la version *weekly*, publiÃ©e chaque semaine, qui contient les derniÃ¨res nouveautÃ©s, mais qui peut Ãªtre moins stable.

** *JDK (Java Development Kit)*

*** Jenkins est Ã©crit en Java, donc il a besoin dâ€™un JDK pour tourner.
*** Le JDK est le kit qui contient :
**** la JVM (Java Virtual Machine) : exÃ©cute le code Java,
**** les *bibliothÃ¨ques Java*,
**** les *outils de compilation*.

Aujourdâ€™hui, Jenkins fonctionne surtout avec les versions Java 11 et Java 17 (LTS Ã©galement cÃ´tÃ© Java).

ğŸ‘‰ Sans JDK, Jenkins ne peut pas dÃ©marrer, un peu comme une voiture sans carburant.



En rÃ©sumÃ© => Jenkins LTS = version stable et recommandÃ©e du logiciel Jenkins
====

image::images/02.png[]



==== CrÃ©ation d'un Dockerfile personnalisÃ©

Nous voulons que notre conteneur Jenkins puisse utiliser Docker pour builder des images et lancer des conteneurs.
Pour cela, nous allons crÃ©er un Dockerfile personnalisÃ© qui utilise l'image officielle de Jenkins comme base et ajoute la possibilitÃ© d'utiliser Docker et Docker Compose.


[source,bash]
----
FROM jenkins/jenkins:lts-jdk21

USER root

# DÃ©pendances + dÃ©pÃ´t Docker officiel
RUN apt-get update && apt-get install -y \
    ca-certificates curl gnupg lsb-release \
 && install -m 0755 -d /etc/apt/keyrings \
 && curl -fsSL https://download.docker.com/linux/debian/gpg \
    | gpg --dearmor -o /etc/apt/keyrings/docker.gpg \
 && chmod a+r /etc/apt/keyrings/docker.gpg \
 && echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] \
    https://download.docker.com/linux/debian \
    $(. /etc/os-release; echo $VERSION_CODENAME) stable" \
    > /etc/apt/sources.list.d/docker.list \
 && apt-get update \
 # ğŸ‘‡ Installe **le client Docker** + **Compose v2 (plugin)**
 && apt-get install -y docker-ce-cli docker-compose-plugin \
 && apt-get clean \
 && rm -rf /var/lib/apt/lists/*

# Revenir Ã  l'utilisateur Jenkins
USER jenkins


----

Puis on Build lâ€™image personnalisÃ©e avec la commande suivante (Ã  exÃ©cuter dans le rÃ©pertoire oÃ¹ se trouve le Dockerfile) :

[source,bash]
----
docker build -t jenkins-with-docker:latest .
----




==== DÃ©marrer le conteneur (Docker) Jenkins
Une fois lâ€™image tÃ©lÃ©chargÃ©e, vous pouvez dÃ©marrer un conteneur Jenkins avec la commande suivante :
[source,bash]
----

export DOCKER_GID=$(stat -c %g /var/run/docker.sock)

docker run -d --name jenkins --restart unless-stopped -p 8080:8080 -p 50000:50000 -v jenkins_home:/var/jenkins_home -v /var/run/docker.sock:/var/run/docker.sock --group-add $(stat -c %g /var/run/docker.sock) jenkins21-with-docker

----

[cols="1,3", options="header"]
|===
| Option | Explication

| `--name jenkins`
| Donne un nom au conteneur (`jenkins` ici), pratique pour le gÃ©rer plus facilement (`docker stop jenkins`, `docker logs jenkins`).

| `-d`
| Lance Jenkins en arriÃ¨re-plan (il continue Ã  tourner mÃªme si tu fermes ton terminal).

| `--restart unless-stopped`
| RedÃ©marre automatiquement aprÃ¨s un crash ou un redÃ©marrage du serveur (sauf si tu arrÃªtes manuellement le conteneur).

| `-p 8080:8080`
| Expose le port web de Jenkins (accÃ¨s Ã  lâ€™interface via `http://localhost:8080`).

| `-p 50000:50000`
| Expose le port utilisÃ© par les agents Jenkins (utile si tu ajoutes des nÅ“uds distants).

| `-v jenkins_home:/var/jenkins_home`
| Volume persistant pour sauvegarder la configuration Jenkins (jobs, plugins, utilisateurs, logsâ€¦).

| `-v /var/run/docker.sock:/var/run/docker.sock`
| Permet Ã  Jenkins dâ€™utiliser Docker de lâ€™hÃ´te (lancer des conteneurs, builder des images), sans installer Docker dans Jenkins.

| `jenkins21-with-docker`
| L'image Docker personnalisÃ©e que nous avons crÃ©Ã©e prÃ©cÃ©demment.
|===
image::images/03.png[]


[IMPORTANT]
====
Un mot de passe de connection initial est gÃ©nÃ©rÃ© lors du premier dÃ©marrage de Jenkins.
Il est accessible via les logs du conteneur Docker.

[source,bash]
----
docker logs jenkins
----
====

image::images/04.png[]

[IMPORTANT]
====
Copiez le mot de passe admin qui s'affiche dans le rÃ©sultat de la commande, comme surlignÃ© sur la
page prÃ©cÃ©dente. Il sera nÃ©cessaire pour configurer le serveur Jenkins.

Mon code : `31cd1a6b2c514252a8e924181e04486f`
====


si vous perdez votre mot de passe, vous pourrez le retrouver en exÃ©cutant la commande suivante :

[source,bash]
----
docker exec -it jenkins /bin/bash
----

Puis une fois dans le shell du conteneur, exÃ©cutez :
[source,bash]
----
cat /var/jenkins_home/secrets/initialAdminPassword
----

image::images/05.png[]


=== Ã‰tape 2 : Configuration initiale de Jenkins

* Ouvrir un onglet du navigateur web et
accÃ©der Ã  :

* http://localhost:8080/ si vous Ãªtes sur une VM locale.
* http://<ip_public> si vous Ãªtes sur un serveur distant.

Se connecter Ã  l'aide de votre mot de passe administrateur prÃ©cÃ©demment copiÃ©.

[TIP]
====
Il est probable que le port `8080` soit bloquÃ© par les rÃ¨gles de votre *pare-feu*. Dans ce cas, vous devez ouvrir ce port pour accÃ©der Ã  l'interface web de Jenkins.

Dans les groupes de sÃ©curitÃ© de votre instance EC2, ajoutez une rÃ¨gle entrante pour autoriser le trafic HTTP (port 8080) depuis votre adresse IP.

image::images/06.png[]

====

Vous devriez voir la page de configuration initiale de Jenkins.

image::images/07.png[]

Cliquez sur Installer les plugins suggÃ©rÃ©s et attendre que Jenkins tÃ©lÃ©charge et installe les plugins.

image::images/08.png[]

image::images/09.png[]

[IMPORTANT]
====
Dans *la fenÃªtre du terminal* depuis laquelle le serveur a Ã©tÃ© lancÃ©, il est possible de suivre lâ€™installation
des plugins Ã  travers les messages de journal affichÃ©s au fur et Ã  mesure que les plugins sâ€™installent. Assurez-vous que vous ne fermez pas cette fenÃªtre de terminal. Si vous avez besoin de lancer des commandes en ligne, ouvrez une autre fenÃªtre de terminal.
====

Une fois l'installation terminÃ©e, la fenÃªtre "*CrÃ©er le 1er utilisateur Administrateur*" s'affiche.
Pour l'instant, cliquez sur *Skip and continue as admin* en bas.

image::images/10.png[]

Dans la fenÃªtre Configuration de lâ€™Instance, ne modifiez rien. Cliquez sur Sauver et Terminer en bas.

image::images/11.png[]

Dans la fenÃªtre suivante, cliquez sur *Commencez Ã  utiliser Jenkins*.

Vous devriez maintenant Ãªtre sur le tableau de bord principal avec un message : "Bienvenue Sur Jenkins !".


